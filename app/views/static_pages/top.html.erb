<body style="background-color: #000; color: #fff; margin:0;">
  <div class="text-center">

    <!-- メイン画像 -->
    <%= image_tag "ogp.png",
      alt: t("application.title"),
      style: "max-width: 100%; height: auto; margin: 2rem 0; border-radius:8px;" %>

    <!-- リピログとは -->
    <div style="max-width: 750px; width: 90%; margin: 2rem auto; padding: 2rem; background-color: #111; border-radius: 12px; box-shadow: 0 0 20px rgba(255,255,255,0.1); text-align: center;">
      <h2 class="mb-4" style="font-weight: bold; color: #fff; font-size: clamp(1.2rem, 2vw, 1.8rem);">
        <%= t("howto_repilog.title") %>
      </h2>
      <p style="line-height: 1.8; color: #fff; margin: 0 auto; max-width:600px; font-size: clamp(0.9rem, 1.5vw, 1rem);">
        <%= simple_format(t("howto_repilog.description")) %>
      </p>
    </div>

    <!-- 使い方 -->
    <div class="container my-5">
      <div class="card bg-dark text-white shadow-lg mx-auto" style="max-width: 750px; width: 90%; border-radius: 15px;">
        <div class="card-body p-4">
          <h3 class="card-title mb-4 text-center" style="font-weight: bold; font-size: clamp(1.2rem, 2vw, 1.6rem);">
            <%= t("howto_repilog.usage_title") %>
          </h3>

          <% steps = [
            { key: "register", title: t("howto_repilog.steps.register.title"), description: t("howto_repilog.steps.register.description") },
            { key: "post", title: t("howto_repilog.steps.post.title"), description: "", steps: t("howto_repilog.steps.post.steps") },
            { key: "repi", title: t("howto_repilog.steps.repi.title"), description: t("howto_repilog.steps.repi.description") },
            { key: "search", title: t("howto_repilog.steps.search.title"), description: t("howto_repilog.steps.search.description") },
            { key: "repi_filter", title: t("howto_repilog.steps.repi_filter.title"), description: t("howto_repilog.steps.repi_filter.description") },
            { key: "mymap", title: t("howto_repilog.steps.mymap.title"), description: t("howto_repilog.steps.mymap.description") },
            { key: "mycalendar", title: t("howto_repilog.steps.mycalendar.title"), description: t("howto_repilog.steps.mycalendar.description") },
            { key: "myranking", title: t("howto_repilog.steps.myranking.title"), description: t("howto_repilog.steps.myranking.description") }
          ] %>

          <ol class="list-unstyled mb-0" style="padding-left:0;">
            <% steps.each_with_index do |step, index| %>
              <li class="mb-0">

                <!-- ステップタイトル -->
                <div class="d-flex align-items-center mb-2 justify-content-start" style="flex-wrap: wrap; text-align: left;">
                  <div class="d-flex align-items-center justify-content-center rounded-circle bg-white text-dark me-3 mb-2"
                       style="width: 2rem; height: 2rem; font-weight: bold; font-size: 1rem; flex-shrink: 0;">
                    <%= index + 1 %>
                  </div>
                  <strong style="font-size: clamp(1rem, 2vw, 1.1rem);"><%= step[:title] %></strong>
                </div>

                <!-- ステップ説明 -->
                <% if step[:description].present? %>
                  <p class="mb-2" style="line-height:1.6; text-align:center; color:#ddd; font-size: clamp(0.9rem, 1.5vw, 1rem);">
                    <%= step[:description].html_safe %>
                  </p>
                <% end %>

                <!-- 「お店を記録」詳細ステップ -->
                <% if step[:steps] %>
                  <ol class="mt-2" style="line-height:1.6; text-align:center; padding-left:0; color:#ddd; list-style:none;">
                    <% step[:steps].each_with_index do |s, i| %>
                      <li style="margin:0; padding:0;">
                        <p style="margin:0; color:#ddd; text-align:center; font-size: clamp(0.9rem, 1.5vw, 1rem);"><%= s %></p>

                        <% if step[:key] == "post" %>
                          <% if i <= 1 %>
                            <div style="max-width:600px; width:100%; margin:1rem auto;">
                              <video class="w-100" style="border-radius:8px;" autoplay muted loop playsinline>
                                <source src="/videos/repilog_post<%= i==1 ? '2' : '' %>.mp4" type="video/mp4">
                              </video>
                            </div>
                          <% elsif i == 2 %>
                            <div style="max-width:600px; width:100%; margin:1rem auto;">
                              <%= image_tag "repilog_posts.png", alt: "マイページ記録サンプル", style: "max-width:100%; height:auto; border-radius:8px;" %>
                            </div>
                          <% elsif i == 3 %>
                            <div style="max-width:600px; width:100%; margin:1rem auto;">
                              <%= image_tag "repilog_show.png", alt: "詳細ページサンプル", style: "max-width:100%; height:auto; border-radius:8px;" %>
                            </div>
                          <% end %>
                        <% end %>
                      </li>
                    <% end %>
                  </ol>
                <% end %>

                <!-- 動画付きのステップ -->
                <% if ["repi","repi_filter","search","mymap","mycalendar"].include?(step[:key]) %>
                  <% video_path = case step[:key]
                    when "repi" then "/videos/repilog_repi.mp4"
                    when "repi_filter" then "/videos/repilog_repi2.mp4"
                    when "search" then "/videos/repilog_search.mp4"
                    when "mymap" then "/videos/repilog_mymap.mp4"
                    when "mycalendar" then "/videos/repilog_mycalendar.mp4"
                  end %>
                  <div style="max-width:600px; width:100%; margin:0.5rem auto;">
                    <video class="w-100" style="border-radius:8px;" autoplay muted loop playsinline>
                      <source src="<%= video_path %>" type="video/mp4">
                    </video>
                  </div>
                <% end %>

                <!-- Myランキングだけ画像 -->
                <% if step[:key] == "myranking" %>
                  <div style="max-width:600px; width:100%; margin:0.5rem auto;">
                    <%= image_tag "repilog_myranking.png", alt: "Myランキングサンプル", style: "max-width:100%; height:auto; border-radius:8px;" %>
                  </div>
                <% end %>

                <!-- 会員登録リンク -->
                <% if step[:key] == "register" %>
                  <div class="text-center mt-3 mb-3">
                    <%= link_to t("howto_repilog.steps.register.button"),
                                new_user_path,
                                class: "btn btn-sm howto-register-btn",
                                style: "background-color:#ffeb99; color:#333; border:none; font-weight:bold;" %>
                  </div>
                <% end %>

              </li>
            <% end %>
          </ol>

          <!-- CTA -->
          <div class="text-center mt-4 mb-5">
            <%= link_to t("howto_repilog.cta"),
                        new_user_path,
                        class: "btn btn-lg",
                        style: "background-color:#ffeb99; color:#333; border:none; font-weight:bold;" %>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- スマホ用ボタン調整 -->
  <style>
    @media (max-width: 768px) {
      a.howto-register-btn.btn.btn-sm {
        font-size: 0.8rem !important;
        padding: 0.3rem 0.6rem !important;
      }
    }
  </style>
</body>
